# CGView Desktop æµ‹è¯•ä½“ç³»æ€»ç»“

## ğŸ“Š å·²å®Œæˆå·¥ä½œ

### 1. æµ‹è¯•æ¡†æ¶æ­å»º
- âœ… é…ç½® Vitest ä½œä¸ºæµ‹è¯•è¿è¡Œå™¨
- âœ… é…ç½® jsdom ç¯å¢ƒç”¨äº React ç»„ä»¶æµ‹è¯•
- âœ… é…ç½® @testing-library/react å’Œ @testing-library/user-event
- âœ… æ·»åŠ æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
- âœ… è®¾ç½®ç¯å¢ƒåˆ†ç¦»ï¼ˆnode ç¯å¢ƒç”¨äºä¸»è¿›ç¨‹ï¼Œjsdom ç”¨äºæ¸²æŸ“è¿›ç¨‹ï¼‰

### 2. æµ‹è¯•æ–‡ä»¶ç¼–å†™

#### è§£æå™¨æµ‹è¯•ï¼ˆå·²åˆ›å»ºï¼‰
1. **JsonAnnotationParser** (`src/main/import/json-parser.test.ts`)
   - æµ‹è¯•æ‘˜è¦ä¿¡æ¯è·å–
   - æµ‹è¯•æ ¼å¼è¯†åˆ«
   - æµ‹è¯•å…ƒæ•°æ®è§£æï¼ˆrecordCount, totalLength, organismï¼‰
   - æµ‹è¯•ç‰¹å¾è§£æå’Œæ¨æ–­
   - æµ‹è¯•é”™è¯¯å¤„ç†ï¼ˆæ— æ•ˆ JSONã€ç©ºæ–‡ä»¶ï¼‰

2. **CsvAnnotationParser** (`src/main/import/csv-parser.test.ts`)
   - æµ‹è¯• CSV è§£æ
   - æµ‹è¯•å¿…éœ€åˆ—éªŒè¯
   - æµ‹è¯•ç©ºæ–‡ä»¶å¤„ç†
   - æµ‹è¯•è­¦å‘Šç”Ÿæˆ
   - æµ‹è¯•é“¾æ–¹å‘è§£æ

3. **GenBankAnnotationParser** (`src/main/import/genbank-parser.test.ts`)
   - æµ‹è¯• LOCUS è§£æ
   - æµ‹è¯•ç‰¹å¾ä½ç½®è§£æï¼ˆcomplement, join ç­‰ï¼‰
   - æµ‹è¯• qualifiers æå–
   - æµ‹è¯•å¤šç§ç‰¹å¾ç±»å‹

4. **Gff3AnnotationParser** (`src/main/import/gff3-parser.test.ts`)
   - æµ‹è¯• GFF3 æ–‡ä»¶è§£æ
   - æµ‹è¯•å±æ€§å­—æ®µæå–
   - æµ‹è¯•é“¾æ–¹å‘å¤„ç†
   - æµ‹è¯•æ³¨é‡Šè¡Œè·³è¿‡

#### IPC æµ‹è¯•ï¼ˆå·²åˆ›å»ºï¼‰
- **ProjectIPC** (`src/main/ipc/projects-ipc.test.ts`)
  - æµ‹è¯•é¡¹ç›®åˆ—è¡¨è·å–
  - æµ‹è¯•é¡¹ç›®åˆ›å»º
  - æµ‹è¯•é¡¹ç›®è·å–
  - æµ‹è¯•æ¿€æ´»é¡¹ç›®ç®¡ç†
  - æµ‹è¯•é”™è¯¯å¤„ç†

#### æ•°æ®åº“æµ‹è¯•ï¼ˆå·²åˆ›å»ºï¼‰
- **SQLiteAdapter** (`src/main/persistence/sqlite-adapter.test.ts`)
  - æµ‹è¯•æ•°æ®åº“åˆå§‹åŒ–
  - æµ‹è¯•è¿ç§»æ‰§è¡Œ
  - æµ‹è¯•é¡¹ç›® CRUD
  - æµ‹è¯•æ•°æ®é›†æ“ä½œ
  - æµ‹è¯•ç‰¹å¾å­˜å‚¨

#### ç»„ä»¶æµ‹è¯•ï¼ˆå·²åˆ›å»ºï¼‰
- **ProjectList** (`src/renderer/components/ProjectList.test.tsx`)
  - æµ‹è¯•é¡¹ç›®åˆ—è¡¨æ¸²æŸ“
  - æµ‹è¯•ç©ºçŠ¶æ€æ˜¾ç¤º
  - æµ‹è¯•é¡¹ç›®é€‰æ‹©
  - æµ‹è¯•æ—¥æœŸæ ¼å¼åŒ–

- **CreateProjectForm** (`src/renderer/components/CreateProjectForm.test.tsx`)
  - æµ‹è¯•è¡¨å•æ¸²æŸ“
  - æµ‹è¯•è¡¨å•æäº¤
  - æµ‹è¯•è¾“å…¥éªŒè¯
  - æµ‹è¯•è¡¨å•é‡ç½®
  - æµ‹è¯•ç¦ç”¨çŠ¶æ€

### 3. æµ‹è¯•é…ç½®
- âœ… `vitest.config.ts` - æµ‹è¯•è¿è¡Œå™¨é…ç½®
- âœ… `src/test/setup.ts` - æµ‹è¯•ç¯å¢ƒè®¾ç½®
- âœ… `src/test/mocks.ts` - å…±äº« mock å·¥å…·
- âœ… `package.json` æ›´æ–°æµ‹è¯•è„šæœ¬ï¼š
  - `npm test` - è¿è¡Œæ‰€æœ‰æµ‹è¯•
  - `npm run test:watch` - ç›‘è§†æ¨¡å¼è¿è¡Œ
  - `npm run test:ui` - å›¾å½¢ç•Œé¢è¿è¡Œ
  - `npm run test:coverage` - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

## ğŸ§ª æµ‹è¯•ç±»å‹

### å•å…ƒæµ‹è¯•ï¼ˆUnit Testsï¼‰
- **è§£æå™¨** - éªŒè¯å„ç§æ–‡ä»¶æ ¼å¼çš„è§£æé€»è¾‘
- **æ•°æ®åº“æ“ä½œ** - éªŒè¯ CRUD æ“ä½œ
- **å·¥å…·å‡½æ•°** - éªŒè¯è¾…åŠ©å‡½æ•°

### é›†æˆæµ‹è¯•ï¼ˆIntegration Testsï¼‰
- **IPC æ¥å£** - éªŒè¯è¿›ç¨‹é—´é€šä¿¡
- **ç»„ä»¶äº¤äº’** - éªŒè¯ç»„ä»¶é—´åä½œ

### ç»„ä»¶æµ‹è¯•ï¼ˆComponent Testsï¼‰
- **æ¸²æŸ“æµ‹è¯•** - éªŒè¯ç»„ä»¶æ­£ç¡®æ¸²æŸ“
- **äº¤äº’æµ‹è¯•** - éªŒè¯ç”¨æˆ·äº¤äº’
- **çŠ¶æ€æµ‹è¯•** - éªŒè¯çŠ¶æ€ç®¡ç†

## ğŸ“ˆ æµ‹è¯•è¦†ç›–èŒƒå›´

### å·²è¦†ç›–æ¨¡å—
1. âœ… æ•°æ®å¯¼å…¥ç³»ç»Ÿ
   - JSON è§£æå™¨
   - CSV è§£æå™¨
   - GenBank è§£æå™¨
   - GFF3 è§£æå™¨

2. âœ… é¡¹ç›®ç®¡ç†
   - é¡¹ç›®åˆ›å»º
   - é¡¹ç›®åˆ—è¡¨
   - é¡¹ç›®è¯¦æƒ…

3. âœ… æ•°æ®æŒä¹…åŒ–
   - SQLite æ“ä½œ
   - æ•°æ®é›†å­˜å‚¨
   - è¿ç§»ç³»ç»Ÿ

4. âœ… IPC é€šä¿¡
   - é¡¹ç›®æ¥å£
   - æ•°æ®é›†æ¥å£

5. âœ… å‰ç«¯ç»„ä»¶
   - ProjectList ç»„ä»¶
   - CreateProjectForm ç»„ä»¶

### å¾…æµ‹è¯•æ¨¡å—
- âš ï¸ WorkspaceView ç»„ä»¶ï¼ˆå¤æ‚äº¤äº’ï¼‰
- âš ï¸ CgviewViewer ç»„ä»¶ï¼ˆéœ€ mock cgview.jsï¼‰
- âš ï¸ DataImportWizard ç»„ä»¶ï¼ˆå¤šæ­¥éª¤è¡¨å•ï¼‰
- âš ï¸ çŠ¶æ€ç®¡ç†ï¼ˆZustand storeï¼‰
- âš ï¸ å›½é™…åŒ–ï¼ˆi18nextï¼‰

## ğŸ¯ è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç›‘è§†æ¨¡å¼ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
npm run test:watch

# å›¾å½¢ç•Œé¢
npm run test:ui

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

## âš ï¸ å·²çŸ¥é—®é¢˜

### 1. Mock é…ç½®å¤æ‚
- `node:fs`ã€`node:crypto` ç­‰ Node.js æ¨¡å—éœ€è¦åœ¨æ¯ä¸ªæµ‹è¯•æ–‡ä»¶ä¸­ç‹¬ç«‹ mock
- éœ€è¦ä½¿ç”¨ `vi.mock(..., async () => ...)` è¯­æ³•

### 2. Electron ç¯å¢ƒé™åˆ¶
- ä¸»è¿›ç¨‹æµ‹è¯•éœ€è¦åœ¨ Node ç¯å¢ƒè¿è¡Œ
- éœ€è¦æ¨¡æ‹Ÿ Electron IPC æ¥å£

### 3. ç¬¬ä¸‰æ–¹åº“ä¾èµ–
- `papaparse` éœ€è¦ç‹¬ç«‹ mock
- `sql.js` éœ€è¦ç‰¹æ®Šå¤„ç†

## ğŸ“ æµ‹è¯•æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ
- æµ‹è¯•æ–‡ä»¶ï¼š`*.test.ts` æˆ– `*.test.tsx`
- æè¿°æ€§æµ‹è¯•åç§°ï¼šä½¿ç”¨ä¸­æ–‡æè¿°æµ‹è¯•ç›®çš„
- æ¯ä¸ªæµ‹è¯•ä¸€ä¸ªæ–­è¨€ï¼šæ¯ä¸ª `it` å—ä¸“æ³¨äºä¸€ä¸ªåœºæ™¯

### 2. éš”ç¦»æ€§
- æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œï¼ˆ`beforeEach` æ¸…ç†ï¼‰
- ä½¿ç”¨ `vi.clearAllMocks()` æ¸…ç† mock
- é¿å…æµ‹è¯•é—´çš„ä¾èµ–

### 3. Mock ç­–ç•¥
- æœ€å°åŒ– mockï¼šåª mock å¤–éƒ¨ä¾èµ–
- çœŸå®é€»è¾‘ï¼šä¿æŒæ ¸å¿ƒé€»è¾‘çœŸå®æµ‹è¯•
- ä¸€è‡´æ€§ï¼šåœ¨æ‰€æœ‰æµ‹è¯•ä¸­ä½¿ç”¨ç›¸åŒçš„ mock

### 4. æµ‹è¯•æ•°æ®
- ä½¿ç”¨çœŸå®æ•°æ®æ ¼å¼
- åŒ…å«è¾¹ç•Œæƒ…å†µ
- æä¾›é”™è¯¯åœºæ™¯

## ğŸš€ æ‰©å±•å»ºè®®

### 1. æ·»åŠ æ›´å¤šç»„ä»¶æµ‹è¯•
```typescript
// ç¤ºä¾‹ï¼šæµ‹è¯•çŠ¶æ€ç®¡ç†
import { renderHook, act } from '@testing-library/react';
import { useProjectStore } from '@/state/project-store';

test('åº”æ­£ç¡®åˆ‡æ¢é¡¹ç›®', async () => {
  const { result } = renderHook(() => useProjectStore());
  await act(async () => {
    await result.current.setActiveProject('project-id');
  });
  expect(result.current.activeProjectId).toBe('project-id');
});
```

### 2. æ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•
- ä½¿ç”¨ Playwright
- æµ‹è¯•å®Œæ•´ç”¨æˆ·æµç¨‹
- è·¨æµè§ˆå™¨æµ‹è¯•

### 3. æ·»åŠ æ€§èƒ½æµ‹è¯•
- å¤§æ•°æ®é›†è§£ææ€§èƒ½
- æ¸²æŸ“æ€§èƒ½
- å†…å­˜ä½¿ç”¨æµ‹è¯•

## ğŸ“š å‚è€ƒèµ„æº

- [Vitest æ–‡æ¡£](https://vitest.dev/)
- [Testing Library æ–‡æ¡£](https://testing-library.com/docs/)
- [React æµ‹è¯•æœ€ä½³å®è·µ](https://react.dev/reference/react/testing)

---

**æ€»ç»“**ï¼šå·²å»ºç«‹å®Œæ•´çš„æµ‹è¯•åŸºç¡€æ¶æ„ï¼ŒåŒ…å«å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç»„ä»¶æµ‹è¯•ã€‚æµ‹è¯•è¦†ç›–äº†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ˆè§£æå™¨ã€é¡¹ç›®ç®¡ç†ã€æ•°æ®æŒä¹…åŒ–ï¼‰å’Œå‰ç«¯ç»„ä»¶ã€‚è¿è¡Œ `npm test` å³å¯æ‰§è¡Œæ‰€æœ‰æµ‹è¯•ã€‚
